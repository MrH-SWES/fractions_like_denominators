<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Fraction Lab</title>
    <style>
        :root {
            --c1: #4CAF50; /* Green */
            --c1-hover: #45a049;
            --c2: #2196F3; /* Blue */
            --c2-hover: #1e88e5;
            --bg: #f8f9fa;
            --card: #ffffff;
            --text: #37474f;
            --border: #cfd8dc;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { margin-bottom: 5px; color: #263238; }
        p.subtitle { margin-top: 0; color: #546e7a; margin-bottom: 30px; }

        /* --- DASHBOARD CONTROLS --- */
        .dashboard {
            background: var(--card);
            padding: 20px 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .equation-display {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: bold;
            gap: 15px;
            margin-bottom: 10px;
        }

        .frac {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            font-size: 2rem;
        }
        .frac span.top { border-bottom: 3px solid #333; padding: 0 5px; display: block; width: 100%; text-align: center; }
        .frac span.bottom { display: block; width: 100%; text-align: center; }
        
        .num-green { color: var(--c1); }
        .num-blue { color: var(--c2); }

        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        /* Mode Toggles */
        .mode-selector {
            display: flex;
            background: #eceff1;
            border-radius: 30px;
            padding: 5px;
            gap: 5px;
        }

        .mode-btn {
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-btn.green { background: transparent; color: #78909c; }
        .mode-btn.green.active { background: var(--c1); color: white; shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        .mode-btn.blue { background: transparent; color: #78909c; }
        .mode-btn.blue.active { background: var(--c2); color: white; shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Slider */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
            justify-content: flex-end;
        }
        
        input[type=range] {
            width: 200px;
            accent-color: #607d8b;
            cursor: pointer;
        }

        /* --- VISUALIZATION AREAS --- */
        .vis-container {
            width: 100%;
            max-width: 900px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .vis-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .vis-title {
            font-weight: 600;
            color: #78909c;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        /* Clickable Bars */
        .bars-wrapper {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        .bar-row {
            display: flex;
            width: 100%;
            max-width: 600px;
            height: 60px;
            border: 3px solid #333;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            cursor: pointer;
        }
        .bar-segment {
            flex: 1;
            border-right: 2px solid #333;
            transition: all 0.1s ease;
            position: relative;
        }
        .bar-segment:last-child { border-right: none; }
        .bar-segment:hover { opacity: 0.8; }
        /* Add a faint plus icon on hover for empty slots */
        .bar-segment.empty:hover::after {
            content: '+';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #ccc;
            font-size: 24px;
        }

        /* Clickable Pies (SVG) */
        .pies-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .pie-svg {
            width: 200px;
            height: 200px;
            cursor: pointer;
        }
        .pie-slice {
            stroke: #333;
            stroke-width: 2;
            transition: fill 0.2s;
        }
        .pie-slice:hover { opacity: 0.85; }

        /* Utility classes */
        .bg-green { background-color: var(--c1); }
        .bg-blue { background-color: var(--c2); }
        .bg-white { background-color: white; }
        
        .fill-green { fill: var(--c1); }
        .fill-blue { fill: var(--c2); }
        .fill-white { fill: white; }

        /* Number Line */
        .number-line-wrapper {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 10px;
        }

    </style>
</head>
<body>

    <h1>Interactive Fraction Builder</h1>
    <p class="subtitle">Click the bars or pie slices to build your fraction!</p>

    <div class="dashboard">
        <div class="equation-display">
            <div class="frac">
                <span class="top num-green" id="disp-n1">1</span>
                <span class="bottom" id="disp-d1">5</span>
            </div>
            <span>+</span>
            <div class="frac">
                <span class="top num-blue" id="disp-n2">2</span>
                <span class="bottom" id="disp-d2">5</span>
            </div>
            <span>=</span>
            <div class="frac">
                <span class="top" id="disp-nt">3</span>
                <span class="bottom" id="disp-dt">5</span>
            </div>
        </div>

        <div class="controls-row">
            <div style="display:flex; flex-direction:column; gap:5px;">
                <label style="font-size:0.8rem; font-weight:bold; color:#78909c;">PAINTING COLOR:</label>
                <div class="mode-selector">
                    <button class="mode-btn green active" id="btn-green" onclick="setMode('green')">
                        First Number
                    </button>
                    <button class="mode-btn blue" id="btn-blue" onclick="setMode('blue')">
                        Second Number
                    </button>
                </div>
            </div>

            <div class="slider-container">
                <label for="den-slider" style="font-weight:bold; color:#546e7a;">Denominator (Size): <span id="den-val">5</span></label>
                <input type="range" id="den-slider" min="2" max="12" value="5" oninput="updateDenominator(this.value)">
            </div>
        </div>
    </div>

    <div class="vis-container">
        
        <div class="vis-card">
            <div class="vis-title">Bar Model (Click to Fill)</div>
            <div class="bars-wrapper" id="bars-root"></div>
        </div>

        <div class="vis-card">
            <div class="vis-title">Circle Model (Click to Fill)</div>
            <div class="pies-wrapper" id="pies-root"></div>
        </div>

        <div class="vis-card">
            <div class="vis-title">Number Line</div>
            <div class="number-line-wrapper" id="nl-root"></div>
        </div>

    </div>

<script>
    // State
    let n1 = 1;
    let n2 = 2;
    let den = 5;
    let activeMode = 'green'; // 'green' or 'blue'

    // Init
    updateAll();

    function setMode(mode) {
        activeMode = mode;
        
        // Update Buttons
        document.getElementById('btn-green').className = `mode-btn green ${mode === 'green' ? 'active' : ''}`;
        document.getElementById('btn-blue').className = `mode-btn blue ${mode === 'blue' ? 'active' : ''}`;
    }

    function updateDenominator(val) {
        den = parseInt(val);
        document.getElementById('den-val').innerText = den;
        updateAll();
    }

    // Logic for clicking a piece
    function handlePieceClick(type) {
        // Type: 'green' (clicked a green piece), 'blue' (clicked blue), 'empty' (clicked empty)
        
        if (type === 'green') {
            if (n1 > 0) n1--;
        } else if (type === 'blue') {
            if (n2 > 0) n2--;
        } else if (type === 'empty') {
            if (activeMode === 'green') n1++;
            else n2++;
        }
        updateAll();
    }

    function updateAll() {
        // Update Text
        document.getElementById('disp-n1').innerText = n1;
        document.getElementById('disp-d1').innerText = den;
        document.getElementById('disp-n2').innerText = n2;
        document.getElementById('disp-d2').innerText = den;
        document.getElementById('disp-nt').innerText = n1 + n2;
        document.getElementById('disp-dt').innerText = den;

        const total = n1 + n2;
        // Calculate how many wholes we need (always show at least one more than full, or just enough)
        // Let's settle on: Enough wholes to fit the data + 1 empty whole for expansion
        // Unless it's exactly even, then just enough.
        // Actually, for UI stability, let's just do Math.ceil(total/den) + (total%den === 0 ? 0 : 1) is confusing.
        // Let's just ensure there is always at least one empty slot available in the last whole, 
        // or if the last whole is full, add a new whole.
        let wholes = Math.ceil(total / den);
        if (total % den === 0 || total === 0) wholes++; 
        if (wholes < 1) wholes = 1;

        renderBars(wholes);
        renderPies(wholes);
        renderNumberLine(wholes);
    }

    // --- RENDER BARS ---
    function renderBars(wholes) {
        const root = document.getElementById('bars-root');
        root.innerHTML = '';

        let count1 = n1;
        let count2 = n2;

        for (let w = 0; w < wholes; w++) {
            const row = document.createElement('div');
            row.className = 'bar-row';
            
            for (let i = 0; i < den; i++) {
                const seg = document.createElement('div');
                seg.className = 'bar-segment';
                
                if (count1 > 0) {
                    seg.classList.add('bg-green');
                    seg.onclick = () => handlePieceClick('green');
                    count1--;
                } else if (count2 > 0) {
                    seg.classList.add('bg-blue');
                    seg.onclick = () => handlePieceClick('blue');
                    count2--;
                } else {
                    seg.classList.add('bg-white', 'empty');
                    seg.onclick = () => handlePieceClick('empty');
                }
                row.appendChild(seg);
            }
            root.appendChild(row);
        }
    }

    // --- RENDER PIES (SVG) ---
    function renderPies(wholes) {
        const root = document.getElementById('pies-root');
        root.innerHTML = '';

        let count1 = n1;
        let count2 = n2;

        for (let w = 0; w < wholes; w++) {
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "pie-svg");
            svg.setAttribute("viewBox", "-1 -1 102 102"); // slight padding

            const cx = 50, cy = 50, r = 50;

            for (let i = 0; i < den; i++) {
                // Determine color
                let type = 'empty';
                let cls = 'fill-white';
                if (count1 > 0) { type = 'green'; cls = 'fill-green'; count1--; }
                else if (count2 > 0) { type = 'blue'; cls = 'fill-blue'; count2--; }

                // Calculate Path
                const startAngle = (i * 360 / den) - 90; // -90 to start at top
                const endAngle = ((i + 1) * 360 / den) - 90;
                
                // Convert to radians
                const startRad = startAngle * Math.PI / 180;
                const endRad = endAngle * Math.PI / 180;

                const x1 = cx + r * Math.cos(startRad);
                const y1 = cy + r * Math.sin(startRad);
                const x2 = cx + r * Math.cos(endRad);
                const y2 = cy + r * Math.sin(endRad);

                // SVG Path command
                // M center L startPoint A radius radius 0 largeArcFlag 1 endPoint Z
                const largeArc = (endAngle - startAngle) > 180 ? 1 : 0;
                
                const d = `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;

                const path = document.createElementNS(svgNS, "path");
                path.setAttribute("d", d);
                path.setAttribute("class", `pie-slice ${cls}`);
                path.onclick = () => handlePieceClick(type);
                
                svg.appendChild(path);
            }
            
            // Draw outer circle stroke (for aesthetics)
            const circle = document.createElementNS(svgNS, "circle");
            circle.setAttribute("cx", cx); circle.setAttribute("cy", cy); circle.setAttribute("r", r);
            circle.setAttribute("fill", "none");
            circle.setAttribute("stroke", "#333");
            circle.setAttribute("stroke-width", "2");
            circle.style.pointerEvents = "none";
            svg.appendChild(circle);

            root.appendChild(svg);
        }
    }

    // --- RENDER NUMBER LINE ---
    function renderNumberLine(wholes) {
        const root = document.getElementById('nl-root');
        root.innerHTML = '';
        
        // Dynamically calculate width
        const width = Math.max(800, wholes * 250);
        const height = 100;
        const margin = 40;
        const effWidth = width - (margin*2);
        
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("width", width);
        svg.setAttribute("height", height);

        // Arrow Marker
        const defs = document.createElementNS(svgNS, "defs");
        const marker = document.createElementNS(svgNS, "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("markerWidth", "10");
        marker.setAttribute("markerHeight", "10");
        marker.setAttribute("refX", "8");
        marker.setAttribute("refY", "3");
        marker.setAttribute("orient", "auto");
        const pathM = document.createElementNS(svgNS, "path");
        pathM.setAttribute("d", "M0,0 L0,6 L9,3 z");
        pathM.setAttribute("fill", "#555");
        marker.appendChild(pathM);
        defs.appendChild(marker);
        svg.appendChild(defs);

        // Main Line
        const line = document.createElementNS(svgNS, "line");
        line.setAttribute("x1", margin); line.setAttribute("y1", 60);
        line.setAttribute("x2", width - margin); line.setAttribute("y2", 60);
        line.setAttribute("stroke", "#333");
        line.setAttribute("stroke-width", "2");
        svg.appendChild(line);

        // Ticks
        const step = effWidth / wholes;
        const subStep = step / den;

        for(let i=0; i<=wholes * den; i++) {
            const x = margin + (i * subStep);
            const isWhole = i % den === 0;
            
            const tick = document.createElementNS(svgNS, "line");
            tick.setAttribute("x1", x); tick.setAttribute("x2", x);
            tick.setAttribute("y1", 60); tick.setAttribute("y2", isWhole ? 75 : 70);
            tick.setAttribute("stroke", "#333");
            tick.setAttribute("stroke-width", isWhole ? 2 : 1);
            svg.appendChild(tick);

            if(isWhole) {
                const txt = document.createElementNS(svgNS, "text");
                txt.setAttribute("x", x); txt.setAttribute("y", 90);
                txt.setAttribute("text-anchor", "middle");
                txt.style.fontFamily = "sans-serif";
                txt.style.fontSize = "14px";
                txt.textContent = i / den;
                svg.appendChild(txt);
            }
        }

        // Arcs
        // Green Arc
        if (n1 > 0) {
            const xStart = margin;
            const xEnd = margin + (n1 * subStep);
            const arc = createJumpArc(svgNS, xStart, xEnd, "var(--c1)");
            svg.appendChild(arc);
        }
        // Blue Arc
        if (n2 > 0) {
            const xStart = margin + (n1 * subStep);
            const xEnd = xStart + (n2 * subStep);
            const arc = createJumpArc(svgNS, xStart, xEnd, "var(--c2)");
            svg.appendChild(arc);
        }

        root.appendChild(svg);
    }

    function createJumpArc(ns, x1, x2, color) {
        const path = document.createElementNS(ns, "path");
        const midX = (x1 + x2) / 2;
        // Curve height depends on distance, capped
        const dist = x2 - x1;
        const h = Math.min(50, 20 + dist/10); 
        
        const d = `M ${x1} 55 Q ${midX} ${55 - h} ${x2} 55`;
        path.setAttribute("d", d);
        path.setAttribute("fill", "none");
        path.setAttribute("stroke", color);
        path.setAttribute("stroke-width", "4");
        path.setAttribute("marker-end", "url(#arrow)");
        return path;
    }

</script>
</body>
</html>
