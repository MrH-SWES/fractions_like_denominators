<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Lab: Bi-Directional</title>
    <style>
        :root {
            --c1: #4CAF50; /* Green */
            --c2: #2196F3; /* Blue */
            --bg: #f0f4f8;
            --card: #ffffff;
            --text: #263238;
            --border: #cfd8dc;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { margin-bottom: 5px; color: #37474f; }
        p.subtitle { margin-top: 0; color: #78909c; margin-bottom: 30px; }

        /* --- CONTROLS DASHBOARD --- */
        .dashboard {
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
            border: 1px solid white;
        }

        .equation-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Input Styling */
        .frac-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90px;
            padding: 10px;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        /* Active State for Inputs (Visual Feedback) */
        .frac-group.active-green {
            background-color: #e8f5e9;
            border-color: var(--c1);
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.2);
        }
        .frac-group.active-blue {
            background-color: #e3f2fd;
            border-color: var(--c2);
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.2);
        }

        .frac-input {
            width: 100%;
            font-size: 2.2rem;
            font-weight: bold;
            text-align: center;
            border: 2px solid #eceff1;
            border-radius: 8px;
            background: #fff;
            color: #455a64;
            padding: 5px 0;
            transition: all 0.2s;
        }
        
        .frac-input:focus {
            outline: none;
            border-color: #90a4ae;
        }

        /* Color specific text */
        .input-n1 { color: var(--c1); }
        .input-n2 { color: var(--c2); }

        .frac-bar {
            width: 100%;
            height: 4px;
            background-color: #455a64;
            margin: 8px 0;
            border-radius: 2px;
        }

        .operator {
            font-size: 3rem;
            color: #90a4ae;
            margin: 0 5px;
            font-weight: 300;
        }

        /* Result Display */
        .result-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90px;
        }
        .result-num, .result-den {
            font-size: 2.2rem;
            font-weight: bold;
            color: #263238;
        }

        /* Mode Toggles */
        .mode-controls {
            display: flex;
            background: #eceff1;
            padding: 6px;
            border-radius: 40px;
            gap: 10px;
        }

        .mode-btn {
            border: none;
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            color: #78909c;
            background: transparent;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-btn:hover { background: rgba(255,255,255,0.5); }

        .mode-btn.green.active {
            background: var(--c1);
            color: white;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .mode-btn.blue.active {
            background: var(--c2);
            color: white;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        /* --- VISUALIZATION CONTAINERS --- */
        .vis-section {
            width: 100%;
            max-width: 900px;
            background: var(--card);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            margin-bottom: 20px;
            border: 1px solid #eceff1;
        }

        .vis-header {
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 0.85rem;
            font-weight: 700;
            color: #90a4ae;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Bars */
        .bars-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        .bar-row {
            display: flex;
            width: 100%;
            max-width: 700px;
            height: 65px;
            border: 3px solid #37474f;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .bar-segment {
            flex: 1;
            border-right: 2px solid #37474f;
            transition: all 0.1s;
        }
        .bar-segment:last-child { border-right: none; }
        .bar-segment:hover { opacity: 0.85; }

        /* Pies */
        .pies-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .pie-svg {
            width: 180px;
            height: 180px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .pie-svg:hover { transform: scale(1.02); }
        .pie-slice { transition: opacity 0.2s; }
        .pie-slice:hover { opacity: 0.8; }

        /* Number Line */
        .number-line-container {
            width: 100%;
            overflow-x: auto; /* Enables scrolling */
            padding-bottom: 10px;
        }

        /* Utility Colors */
        .bg-green { background-color: var(--c1); }
        .bg-blue { background-color: var(--c2); }
        .bg-white { background-color: white; }
        .fill-green { fill: var(--c1); }
        .fill-blue { fill: var(--c2); }
        .fill-white { fill: white; }

    </style>
</head>
<body>

    <h1>Interactive Fraction Lab</h1>
    <p class="subtitle">Type numbers or paint shapes. Watch them sync!</p>

    <div class="dashboard">
        <div class="mode-controls">
            <button class="mode-btn green active" id="btn-green" onclick="setMode('green')">
                <span>Paint Green</span>
            </button>
            <button class="mode-btn blue" id="btn-blue" onclick="setMode('blue')">
                <span>Paint Blue</span>
            </button>
        </div>

        <div class="equation-wrapper">
            <div class="frac-group active-green" id="group-n1">
                <input type="number" id="in-n1" class="frac-input input-n1" value="1" min="0" oninput="handleInput()">
                <div class="frac-bar"></div>
                <input type="number" id="in-d1" class="frac-input" value="5" min="1" max="20" oninput="handleDenomChange(this.value)">
            </div>

            <div class="operator">+</div>

            <div class="frac-group" id="group-n2">
                <input type="number" id="in-n2" class="frac-input input-n2" value="2" min="0" oninput="handleInput()">
                <div class="frac-bar"></div>
                <input type="number" id="in-d2" class="frac-input" value="5" min="1" max="20" oninput="handleDenomChange(this.value)">
            </div>

            <div class="operator">=</div>

            <div class="result-group">
                <span id="res-n" class="result-num">3</span>
                <div class="frac-bar"></div>
                <span id="res-d" class="result-den">5</span>
            </div>
        </div>
    </div>

    <div class="vis-section">
        <div class="vis-header">Bar Model</div>
        <div class="bars-container" id="bars-root"></div>
    </div>

    <div class="vis-section">
        <div class="vis-header">Circle Model</div>
        <div class="pies-container" id="pies-root"></div>
    </div>

    <div class="vis-section">
        <div class="vis-header">Dynamic Number Line</div>
        <div class="number-line-container" id="nl-root"></div>
    </div>

<script>
    // --- State Management ---
    let n1 = 1;
    let n2 = 2;
    let den = 5;
    let activeMode = 'green'; 

    // Initial Render
    updateAll(true);

    // --- Interaction Handlers ---

    function setMode(mode) {
        activeMode = mode;
        
        // Toggle Button Styles
        document.getElementById('btn-green').className = `mode-btn green ${mode === 'green' ? 'active' : ''}`;
        document.getElementById('btn-blue').className = `mode-btn blue ${mode === 'blue' ? 'active' : ''}`;
        
        // Toggle Input Highlights (Teaching moment: Focus follows action)
        const group1 = document.getElementById('group-n1');
        const group2 = document.getElementById('group-n2');
        
        if(mode === 'green') {
            group1.classList.add('active-green');
            group2.classList.remove('active-blue');
        } else {
            group1.classList.remove('active-green');
            group2.classList.add('active-blue');
        }
    }

    // Called when user types in the input boxes
    function handleInput() {
        const v1 = parseInt(document.getElementById('in-n1').value);
        const v2 = parseInt(document.getElementById('in-n2').value);
        
        if (!isNaN(v1) && v1 >= 0) n1 = v1;
        if (!isNaN(v2) && v2 >= 0) n2 = v2;
        
        updateAll(false); // False = Don't overwrite what the user is currently typing
    }

    // Called when user changes denominator
    function handleDenomChange(val) {
        let v = parseInt(val);
        if (isNaN(v) || v < 1) v = 1;
        if (v > 25) v = 25; // Performance cap
        
        den = v;
        updateAll(true); // Update everything including syncing the other denom input
    }

    // Called when user clicks a visual piece
    function handlePieceClick(type) {
        // Logic: 
        // 1. If clicking a filled piece, remove it (regardless of mode, usually).
        // 2. If clicking an empty piece, add to current Active Mode color.
        
        if (type === 'green') {
            if (n1 > 0) n1--;
        } else if (type === 'blue') {
            if (n2 > 0) n2--;
        } else if (type === 'empty') {
            if (activeMode === 'green') n1++;
            else n2++;
        }
        updateAll(true); // True = Force update inputs to match the visual change
    }

    // --- Main Update Loop ---

    function updateAll(syncInputs) {
        // 1. Sync Inputs (Bi-directional)
        if (syncInputs) {
            document.getElementById('in-n1').value = n1;
            document.getElementById('in-n2').value = n2;
            document.getElementById('in-d1').value = den;
            document.getElementById('in-d2').value = den;
        }

        // 2. Update Result Text
        const total = n1 + n2;
        document.getElementById('res-n').innerText = total;
        document.getElementById('res-d').innerText = den;

        // 3. Determine Wholes needed (for visuals)
        // Ensure we always have enough space plus a little extra if it fits exactly
        let wholes = Math.ceil(total / den);
        if (total % den === 0 || total === 0) wholes++; 
        if (wholes < 1) wholes = 1;

        // 4. Render Visuals
        renderBars(wholes);
        renderPies(wholes);
        renderNumberLine(wholes);
    }

    // --- Renderers ---

    function renderBars(wholes) {
        const root = document.getElementById('bars-root');
        root.innerHTML = '';
        let c1 = n1, c2 = n2;

        for (let w = 0; w < wholes; w++) {
            const row = document.createElement('div');
            row.className = 'bar-row';
            
            for (let i = 0; i < den; i++) {
                const seg = document.createElement('div');
                seg.className = 'bar-segment';
                
                // Determine Segment Color
                if (c1 > 0) {
                    seg.classList.add('bg-green');
                    seg.onclick = () => handlePieceClick('green');
                    c1--;
                } else if (c2 > 0) {
                    seg.classList.add('bg-blue');
                    seg.onclick = () => handlePieceClick('blue');
                    c2--;
                } else {
                    seg.classList.add('bg-white');
                    seg.onclick = () => handlePieceClick('empty');
                }
                row.appendChild(seg);
            }
            root.appendChild(row);
        }
    }

    function renderPies(wholes) {
        const root = document.getElementById('pies-root');
        root.innerHTML = '';
        let c1 = n1, c2 = n2;

        for (let w = 0; w < wholes; w++) {
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "pie-svg");
            svg.setAttribute("viewBox", "-2 -2 104 104");
            const cx = 50, cy = 50, r = 50;

            for (let i = 0; i < den; i++) {
                // Determine Slice Color
                let type = 'empty';
                let cls = 'fill-white';
                if (c1 > 0) { type = 'green'; cls = 'fill-green'; c1--; }
                else if (c2 > 0) { type = 'blue'; cls = 'fill-blue'; c2--; }

                // Math for Slice Geometry
                const startAngle = (i * 360 / den) - 90;
                const endAngle = ((i + 1) * 360 / den) - 90;
                const rad = Math.PI / 180;
                
                const x1 = cx + r * Math.cos(startAngle * rad);
                const y1 = cy + r * Math.sin(startAngle * rad);
                const x2 = cx + r * Math.cos(endAngle * rad);
                const y2 = cy + r * Math.sin(endAngle * rad);
                
                const largeArc = (endAngle - startAngle) > 180 ? 1 : 0;
                
                // SVG Path
                const d = `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;

                const path = document.createElementNS(svgNS, "path");
                path.setAttribute("d", d);
                path.setAttribute("class", `pie-slice ${cls}`);
                path.setAttribute("stroke", "#37474f");
                path.setAttribute("stroke-width", "1");
                path.onclick = () => handlePieceClick(type);
                svg.appendChild(path);
            }
            root.appendChild(svg);
        }
    }

    function renderNumberLine(wholes) {
        const root = document.getElementById('nl-root');
        root.innerHTML = '';
        
        // Dynamic Width Calculation
        // We use a fixed pixel width per Unit to ensure labels don't overlap
        const pxPerUnit = Math.max(250, den * 50); // Scale based on denominator
        const width = Math.max(800, wholes * pxPerUnit + 100);
        const height = 180;
        const margin = 50;
        
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("width", width);
        svg.setAttribute("height", height);

        // Arrow Marker Def
        const defs = document.createElementNS(svgNS, "defs");
        const marker = document.createElementNS(svgNS, "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("markerWidth", "10");
        marker.setAttribute("markerHeight", "10");
        marker.setAttribute("refX", "8");
        marker.setAttribute("refY", "3");
        marker.setAttribute("orient", "auto");
        const pathM = document.createElementNS(svgNS, "path");
        pathM.setAttribute("d", "M0,0 L0,6 L9,3 z");
        pathM.setAttribute("fill", "#546e7a");
        marker.appendChild(pathM);
        defs.appendChild(marker);
        svg.appendChild(defs);

        const yLine = 100;

        // Main Line
        const line = document.createElementNS(svgNS, "line");
        line.setAttribute("x1", margin); line.setAttribute("y1", yLine);
        line.setAttribute("x2", width - margin); line.setAttribute("y2", yLine);
        line.setAttribute("stroke", "#37474f");
        line.setAttribute("stroke-width", "3");
        svg.appendChild(line);

        // Ticks and Labels
        const totalTicks = wholes * den;
        const step = pxPerUnit / den;

        for (let i = 0; i <= totalTicks; i++) {
            const x = margin + (i * step);
            const isWhole = (i % den === 0);
            
            // Tick Mark
            const tick = document.createElementNS(svgNS, "line");
            tick.setAttribute("x1", x); tick.setAttribute("x2", x);
            tick.setAttribute("y1", yLine); 
            tick.setAttribute("y2", yLine + (isWhole ? 20 : 10));
            tick.setAttribute("stroke", "#37474f");
            tick.setAttribute("stroke-width", isWhole ? 3 : 1.5);
            svg.appendChild(tick);

            // Fraction Label (Small)
            const fracTxt = document.createElementNS(svgNS, "text");
            fracTxt.setAttribute("x", x);
            fracTxt.setAttribute("y", yLine + 40);
            fracTxt.setAttribute("text-anchor", "middle");
            fracTxt.setAttribute("font-size", "14px");
            fracTxt.setAttribute("fill", "#78909c");
            fracTxt.textContent = `${i}/${den}`;
            svg.appendChild(fracTxt);

            // Integer Label (Large, underneath fraction)
            if (isWhole) {
                const intTxt = document.createElementNS(svgNS, "text");
                intTxt.setAttribute("x", x);
                intTxt.setAttribute("y", yLine + 75); 
                intTxt.setAttribute("text-anchor", "middle");
                intTxt.setAttribute("font-size", "28px");
                intTxt.setAttribute("font-weight", "bold");
                intTxt.setAttribute("fill", "#37474f");
                intTxt.textContent = i / den;
                svg.appendChild(intTxt);
            }
        }

        // Jump Arcs (Green & Blue)
        if (n1 > 0) {
            const x1 = margin;
            const x2 = margin + (n1 * step);
            svg.appendChild(createJumpArc(svgNS, x1, x2, yLine, "var(--c1)"));
        }
        if (n2 > 0) {
            const x1 = margin + (n1 * step);
            const x2 = x1 + (n2 * step);
            svg.appendChild(createJumpArc(svgNS, x1, x2, yLine, "var(--c2)"));
        }

        root.appendChild(svg);
    }

    function createJumpArc(ns, x1, x2, yBase, color) {
        const path = document.createElementNS(ns, "path");
        const midX = (x1 + x2) / 2;
        // Calculate arc height based on distance, capped for aesthetics
        const dist = x2 - x1;
        const h = Math.min(80, 30 + dist/8); 
        const yTop = yBase - h;

        const d = `M ${x1} ${yBase-5} Q ${midX} ${yTop} ${x2} ${yBase-5}`;
        
        path.setAttribute("d", d);
        path.setAttribute("fill", "none");
        path.setAttribute("stroke", color);
        path.setAttribute("stroke-width", "4");
        path.setAttribute("stroke-linecap", "round");
        path.setAttribute("marker-end", "url(#arrow)");
        path.style.opacity = "0.9";
        return path;
    }

</script>
</body>
</html>
